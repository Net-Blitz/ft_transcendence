{"ast":null,"code":"import { selectUser } from './selectors';\nimport axios from 'axios';\nimport { createAction, createReducer } from '@reduxjs/toolkit';\n\n// First State\nconst initialState = {\n  auth: false,\n  status: 'void',\n  data: null,\n  error: null\n};\n\n// Actions Creators\nconst userAuth = createAction('user/auth');\nconst userStatus = createAction('user/status');\nconst userFetching = createAction('user/fetching');\nconst userResolved = createAction('user/resolved');\nconst userRejected = createAction('user/rejected');\nexport async function fetchOrUpdateUser(store) {\n  try {\n    const response = await axios.get('http://localhost:3333/auth/verify', {\n      withCredentials: true\n    });\n    const data = response.data;\n    if (data === 'OK') {\n      store.dispatch(userStatus('void'));\n      store.dispatch(userAuth(true));\n    }\n  } catch (error) {\n    store.dispatch(userStatus('notAuth'));\n    store.dispatch(userAuth(false));\n    return;\n  }\n  const status = selectUser(store.getState()).status;\n  if (status === 'pending' || status === 'updating') {\n    return;\n  }\n  store.dispatch(userFetching());\n  try {\n    const response = await axios.get('http://localhost:3333/users/me', {\n      withCredentials: true\n    });\n    response.data.avatar = `http://localhost:3333/${response.data.avatar}`;\n    const data = response.data;\n    store.dispatch(userResolved(data));\n  } catch (error) {\n    store.dispatch(userRejected(error));\n  }\n}\n\n// Reducer\nexport default createReducer(initialState, builder => builder.addCase(userAuth, (draft, action) => {\n  draft.auth = action.payload;\n  return;\n}).addCase(userStatus, (draft, action) => {\n  draft.status = action.payload;\n  return;\n}).addCase(userFetching, (draft, action) => {\n  if (draft.status === 'void') {\n    draft.status = 'pending';\n    return;\n  }\n  if (draft.status === 'rejected') {\n    draft.error = null;\n    draft.status = 'pending';\n    return;\n  }\n  if (draft.status === 'resolved') {\n    draft.status = 'updating';\n    return;\n  }\n  return;\n}).addCase(userResolved, (draft, action) => {\n  if (draft.status === 'pending' || draft.status === 'updating') {\n    draft.data = action.payload;\n    draft.status = 'resolved';\n    return;\n  }\n  return;\n}).addCase(userRejected, (draft, action) => {\n  if (draft.status === 'pending' || draft.status === 'updating') {\n    draft.error = action.payload;\n    draft.data = null;\n    draft.status = 'rejected';\n    return;\n  }\n  return;\n}));","map":{"version":3,"names":["selectUser","axios","createAction","createReducer","initialState","auth","status","data","error","userAuth","userStatus","userFetching","userResolved","userRejected","fetchOrUpdateUser","store","response","get","withCredentials","dispatch","getState","avatar","builder","addCase","draft","action","payload"],"sources":["/app/src/utils/redux/user.ts"],"sourcesContent":["import { selectUser } from './selectors';\nimport axios from 'axios';\nimport { createAction, createReducer } from '@reduxjs/toolkit';\n\n// First State\nconst initialState = {\n\tauth: false,\n\tstatus: 'void',\n\tdata: null,\n\terror: null,\n};\n\n// Actions Creators\nconst userAuth = createAction<any>('user/auth');\nconst userStatus = createAction<any>('user/status');\nconst userFetching = createAction('user/fetching');\nconst userResolved = createAction<any>('user/resolved');\nconst userRejected = createAction<any>('user/rejected');\n\nexport async function fetchOrUpdateUser(store: any) {\n\ttry {\n\t\tconst response = await axios.get('http://localhost:3333/auth/verify', {\n\t\t\twithCredentials: true,\n\t\t});\n\t\tconst data = response.data;\n\t\tif (data === 'OK') {\n\t\t\tstore.dispatch(userStatus('void'));\n\t\t\tstore.dispatch(userAuth(true));\n\t\t}\n\t} catch (error) {\n\t\tstore.dispatch(userStatus('notAuth'));\n\t\tstore.dispatch(userAuth(false));\n\t\treturn;\n\t}\n\tconst status = selectUser(store.getState()).status;\n\tif (status === 'pending' || status === 'updating') {\n\t\treturn;\n\t}\n\tstore.dispatch(userFetching());\n\ttry {\n\t\tconst response = await axios.get('http://localhost:3333/users/me', {\n\t\t\twithCredentials: true,\n\t\t});\n\t\tresponse.data.avatar = `http://localhost:3333/${response.data.avatar}`;\n\t\tconst data = response.data;\n\t\tstore.dispatch(userResolved(data));\n\t} catch (error) {\n\t\tstore.dispatch(userRejected(error));\n\t}\n}\n\n// Reducer\nexport default createReducer(initialState, (builder) =>\n\tbuilder\n\t\t.addCase(userAuth, (draft, action) => {\n\t\t\tdraft.auth = action.payload;\n\t\t\treturn;\n\t\t})\n\t\t.addCase(userStatus, (draft, action) => {\n\t\t\tdraft.status = action.payload;\n\t\t\treturn;\n\t\t})\n\t\t.addCase(userFetching, (draft, action) => {\n\t\t\tif (draft.status === 'void') {\n\t\t\t\tdraft.status = 'pending';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (draft.status === 'rejected') {\n\t\t\t\tdraft.error = null;\n\t\t\t\tdraft.status = 'pending';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (draft.status === 'resolved') {\n\t\t\t\tdraft.status = 'updating';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn;\n\t\t})\n\t\t.addCase(userResolved, (draft, action) => {\n\t\t\tif (draft.status === 'pending' || draft.status === 'updating') {\n\t\t\t\tdraft.data = action.payload;\n\t\t\t\tdraft.status = 'resolved';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn;\n\t\t})\n\t\t.addCase(userRejected, (draft, action) => {\n\t\t\tif (draft.status === 'pending' || draft.status === 'updating') {\n\t\t\t\tdraft.error = action.payload;\n\t\t\t\tdraft.data = null;\n\t\t\t\tdraft.status = 'rejected';\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn;\n\t\t})\n);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}